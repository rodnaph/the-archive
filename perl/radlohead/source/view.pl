###############################################################################################
###############################################################################################
##
##  view.pl
##
###############################################################################################
###############################################################################################

use strict;
use CGI;
use FileHandle qw( getline );

###############################################################################################

use constant BASE => 'f:/newmind/radiohead/';

###############################################################################################

my $q = new CGI;
my $file = $q->param('file');
my @secure_folders = qw( admin files files/users files/mailbox );

###############################################################################################

if ( $file =~ /(jpg|gif|png|jpeg)$/ ) {

  print $q->redirect( '/sites/radlohead' . $file );

} else {

  print "Content-type: text/plain\n\n";

  $file =~ s/^\///;

  my $fh = new FileHandle( BASE . $file );
  if ( $fh && public_file($file) ) {
    while( my $line = $fh->getline() ) {
      print $line;
    }
  } else {

    print <<EOT
Error: The file requested either does not exist or has its access restricted.

Please contact the Webmaster at...
http://www.radlohead.com/03.pl?todo=contact

_____________________________________________________________________________
radlohead.com
EOT

  }

}

###############################################################################################
##
##  public_file(file)
##
###############################################################################################

sub public_file {

  my ( $file ) = @_;

  foreach my $fld ( @secure_folders ) {
    if ( $file =~ /^$fld\/(.*)/i ) {
      if( $1 !~ /\// ) { return 0; }
    }
  }

  return 1;

}

###############################################################################################
###############################################################################################