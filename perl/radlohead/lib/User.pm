###############################################################################################
###############################################################################################
##
##  User.pm
##
###############################################################################################
###############################################################################################

package User;

###############################################################################################

use strict;

use Profile;
use Encoding;

###############################################################################################
##
##  new( username, password, color, has_image )
##
###############################################################################################

sub new {

  my ( $pkg ) = shift();

  my $self = bless {}, $pkg;

  $self->load( @_ );

  return $self;

}

###############################################################################################
##
##  load( username, password, color, has_image )
##
###############################################################################################

sub load {

  my ( $self ) = shift();

  foreach my $property ( $self->get_properties() ) {
    $self->_property( $property, shift() );
  }

}

###############################################################################################
##
##  AUTOLOAD()
##
###############################################################################################

sub AUTOLOAD {

  my ( $self ) = shift;
  my ( $value ) = @_;

  my ( $sub_name ) = $User::AUTOLOAD =~ /^User::(.*)/;

  return eval( "\$self->_property( '$sub_name', '$value' );" );

}

###############################################################################################
##
##  profile()
##
###############################################################################################

sub profile {

  my ( $self ) = shift();

  return new Profile( $self->username() );

}

###############################################################################################
##
##  draw()
##
###############################################################################################

sub draw {

  my ( $self ) = shift();

  print $self->get_html();

}

###############################################################################################
##
##  get_html()
##
###############################################################################################

sub get_html {

  my ( $self ) = shift();

  my ( $html ) = undef();
  my ( $tag ) = (Profile::has_profile($self->username())) ? 'b' : 'i';

  $html .= '<a href="/07.pl?profile=' . Encoding::encode( $self->username() ) . '">' .
           '<' . $tag . '><font color="#' . $self->color() . '">' . $self->username() .
           '</font></' . $tag . '></a>' . "\n\n";

  if ( $self->has_image() ) {
    $html .= qq{\n&nbsp;<a href="javascript:showUserImage('@{[ Encoding::encode($self->username()) ]}')">} .
             qq{<img border="0" src="/files/images/site/has_image.gif" width="12" height="12" alt="Click To View" /></a> \n\n};
  }

  return $html;

}

###############################################################################################
##
##  _property( name, value )
##
###############################################################################################

sub _property {

  my ( $self ) = shift();
  my ( $name, $value ) = @_;

  $self->{$name} = $value unless !$value;

  return $self->{$name};

}

###############################################################################################
##
##  get_properties()
##
###############################################################################################

sub get_properties {

  my ( $self ) = shift();

  return qw( username password color has_image );

}

###############################################################################################
##
##  save()
##
###############################################################################################

sub save {

  my ( $self ) = shift();

  my $users = new UserFile( $self->username() );

  $users->add( $self );
  $users->save();

}

###############################################################################################
##
##  DESTROY()
##
###############################################################################################

sub DESTROY {
}

###############################################################################################

1;

###############################################################################################
###############################################################################################