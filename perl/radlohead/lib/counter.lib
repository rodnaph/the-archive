##########################################################
##########################################################
##
##  counter.lib
##
##########################################################
##########################################################

use strict;
use FileHandle;

##########################################################

use constant COUNTERS_DIR => BASE . "files/counters/";
use constant EXT => ".txt";

##########################################################
##########################################################

##########################################################
##
##  inc_counter(file)
##
##########################################################

sub inc_counter {

  my ($file) = @_;

  return change_val($file,1);

}

##########################################################
##
##  dec_counter(file)
##
##########################################################

sub dec_counter {

  my ($file) = @_;

  return change_val($file,-1);

}

##########################################################
##
##  change_val(file,val)
##  (internal)
##
##########################################################

sub change_val {

  my ($file,$val) = @_;

  my $count;

  {
    my $fh = new FileHandle(COUNTERS_DIR . $file . EXT);
    chomp($count = <$fh>);
  }
  $count += $val;
  {
    my $fh = new FileHandle(COUNTERS_DIR . $file . EXT, ">");
    print $fh $count;
  }

  return $count;

}

##########################################################
##
##  get_counter(file)
##
##########################################################

sub get_counter {

  my ($file) = @_;

  my $fh = new FileHandle(COUNTERS_DIR . $file . EXT);
  if ($fh) {
    chomp(my $count = <$fh>);
    return $count;
  } else {
    my $fh = new FileHandle(COUNTERS_DIR . $file . EXT, ">");
    print $fh 0;
    return 0;
  }

}

##########################################################

1;

##########################################################